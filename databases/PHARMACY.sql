/* Start isql.exe<PHARMACY.sql */

/*connect 'tiger.ftk.spbstu.ru:/var/lib/firebird/435013/pharmacy.fdb' user 'SYSDBA' password 'masterkey';
drop database;
commit;
create database 'tiger.ftk.spbstu.ru:/var/lib/firebird/435013/pharmacy.fdb' user 'SYSDBA' password 'masterkey';
commit;
connect 'tiger.ftk.spbstu.ru:/var/lib/firebird/435013/pharmacy.fdb' user 'SYSDBA' password 'masterkey';*/

/*create database '127.0.0.1/3050:d:\afiles\student\7\databases\PHARMACY.FDB' user 'SYSDBA' password '1111';
commit;*/
connect '127.0.0.1/3050:d:\afiles\student\7\databases\PHARMACY.FDB' user 'SYSDBA' password '1111';

SET NAMES CYRL;

DROP TABLE REQUEST_FROM_CONSIGNMENT;
commit;
DROP TABLE REQUEST;
commit;
DROP TABLE CONSIGNMENT;
commit;
DROP TABLE PROVIDER;
commit;
DROP TABLE INCOMPATIBILITY;
commit;
DROP TABLE CONTRAINDICATION;
commit;
DROP TABLE DRUG;
commit;
DROP TABLE DISEASE;
commit; 

CREATE TABLE DISEASE 
(
  ID_DISEASE                INTEGER         NOT NULL,
  DISEASE_NAME              VARCHAR(256)    NOT NULL COLLATE NONE,
CONSTRAINT PK_DISEASE PRIMARY KEY (ID_DISEASE)
); 

commit;

CREATE TABLE DRUG 
(
  ID_DRUG                INTEGER         NOT NULL,
  DRUG_NAME              VARCHAR(256)    NOT NULL COLLATE NONE,  
  DRUG_SHELF_LIFE        INTEGER	 NOT NULL,  
  DRUG_CURRENT_COST      DECIMAL(18,4)   NOT NULL, 
  DRUG_RECIPE_NEEDED     CHAR(1)         NOT NULL,
  CONSTRAINT PK_DRUG PRIMARY KEY (ID_DRUG)
);

commit;

CREATE TABLE CONTRAINDICATION 
(
  ID_CONTRAINDICATION               INTEGER         NOT NULL,
  ID_DISEASE                        INTEGER         NOT NULL REFERENCES DISEASE,
  ID_DRAG                           INTEGER         NOT NULL REFERENCES DRUG,
 CONSTRAINT PK_CONTRAINDICATION PRIMARY KEY (ID_CONTRAINDICATION)
);

commit;

CREATE TABLE INCOMPATIBILITY 
(
  ID_INCOMPATIBILITY              INTEGER         NOT NULL,
  ID_DRAG_FIRST                   INTEGER         NOT NULL  REFERENCES DRUG,
  ID_DRAG_SECOND                  INTEGER         NOT NULL  REFERENCES DRUG,
 CONSTRAINT PK_INCOMPATIBILITY PRIMARY KEY (ID_INCOMPATIBILITY)
);

commit;

CREATE TABLE PROVIDER 
(
  ID_PROVIDER                     INTEGER         NOT NULL,
  PROVIDER_NAME                   VARCHAR(256)    NOT NULL,
 CONSTRAINT PK_PROVIDER PRIMARY KEY (ID_PROVIDER)
);

commit;

CREATE TABLE CONSIGNMENT 
(
  ID_CONSIGNMENT                  INTEGER         NOT NULL,
  ID_DRAG                         INTEGER         NOT NULL  REFERENCES DRUG,
  ID_PROVIDER                     INTEGER         NOT NULL  REFERENCES PROVIDER,
  CONSIGNMENT_DRAG_COUNT          INTEGER         NOT NULL,
  CONSIGNMENT_ARRIVAL_DATE        TIMESTAMP       NOT NULL, 
  CONSIGNMENT_MANUFACTURE_DATE    TIMESTAMP       NOT NULL,
 CONSTRAINT PK_CONSIGNMENT PRIMARY KEY (ID_CONSIGNMENT)
);

commit;

CREATE TABLE REQUEST 
(
  ID_REQUEST                     INTEGER         NOT NULL,
  REQUEST_DATE                   TIMESTAMP       NOT NULL,
 CONSTRAINT PK_REQUEST PRIMARY KEY (ID_REQUEST)
);

commit;

CREATE TABLE REQUEST_FROM_CONSIGNMENT
(
  ID_REQUEST_FROM_CONSIGNMENT    INTEGER         NOT NULL,
  ID_REQUEST                     INTEGER         NOT NULL  REFERENCES REQUEST,
  ID_CONSIGNMENT                 INTEGER         NOT NULL  REFERENCES CONSIGNMENT,
  DRUG_PREVIOUS_COST             DECIMAL(18,4)   NOT NULL,
  DRUG_COUNT             	 INTEGER   	 NOT NULL,
 CONSTRAINT PK_REQUEST_FROM_CONSIGNMENT PRIMARY KEY (ID_REQUEST_FROM_CONSIGNMENT)
);

commit;
show tables;

INSERT INTO DISEASE (ID_DISEASE, DISEASE_NAME) VALUES (1, 'Ветрянка'); 
INSERT INTO DISEASE (ID_DISEASE, DISEASE_NAME) VALUES (2, 'Корь'); 
INSERT INTO DISEASE (ID_DISEASE, DISEASE_NAME) VALUES (3, 'ОРЗ'); 
INSERT INTO DISEASE (ID_DISEASE, DISEASE_NAME) VALUES (4, 'Язва'); 
INSERT INTO DISEASE (ID_DISEASE, DISEASE_NAME) VALUES (5, 'Импотенция'); 

commit;
SELECT * FROM DISEASE;

INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (1, 'Аспирин', 30, 32.22, 0); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (2, 'Нурафен', 40, 55.10, 0); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (3, 'Аспоркам', 20, 69.80, 1); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (4, 'Ношпа', 35, 20.90, 0); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (5, 'Диазолин', 50, 11.0, 0); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (6, 'Мезим', 30, 41.20, 0); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (7, 'Регидрон', 70, 5.40, 0); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (8, 'Флуоксетин', 50, 15.40, 1); 
INSERT INTO DRUG (ID_DRUG, DRUG_NAME, DRUG_SHELF_LIFE, DRUG_CURRENT_COST, DRUG_RECIPE_NEEDED)
VALUES (9, 'Супрадин', 30, 25.0, 0); 

commit;
SELECT * FROM DRUG;

INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (1, 1, 8);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (2, 2, 3);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (3, 1, 2);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (4, 4, 3);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (5, 6, 8);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (6, 3, 7);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (7, 9, 1);
INSERT INTO INCOMPATIBILITY (ID_INCOMPATIBILITY,  ID_DRAG_FIRST, ID_DRAG_SECOND) VALUES (8, 3, 4); 

commit;
SELECT * FROM INCOMPATIBILITY;


INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (1, 4, 8);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (2, 4, 3);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (3, 1, 6);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (4, 1, 2);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (5, 3, 3);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (6, 3, 7);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (7, 3, 9);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (8, 4, 2);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (9, 5, 6);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (10, 5, 1);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (11, 2, 4);
INSERT INTO CONTRAINDICATION (ID_CONTRAINDICATION,  ID_DISEASE, ID_DRAG) VALUES (12, 2, 5);

commit;
SELECT * FROM CONTRAINDICATION;
